<!DOCTYPE html>
<html><head>
<title>SmartHousePC Devices View Page</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="HTML KickStart is a ultraâ€“lean set of HTML5, CSS, and jQuery (javascript) files, layouts, and elements designed to give you a headstart and save you a lot of hours on your next web project." />
<meta name="copyright" content="Joshua Gatcke 99lime.com All Rights Reserved" />
<script src="js/sorttable.js"></script>
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<link rel="stylesheet" type="text/css" href="css/style.css" media="all" /> 
<link rel="stylesheet" type="text/css" href="css/w3c.css" media="all" /> 
<link rel="stylesheet" type="text/css" href="css/kickstart.css" media="all" />               <!--  KICKSTART -->
<link rel="stylesheet" type="text/css" href="header.css" media="all" />        <!--   CUSTOM STYLES
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="js/kickstart.js"></script>                                  <!-- KICKSTART -->
</head><body>
<!-- ===================================== END HEADER ===================================== -->
<!-- ===================================== NAVIGATION BAR ===================================== -->
	<nav class="navbar">
		
			
			
			<a class="hide-phone" id="logo" href="http://duinocloud.org" title="Go to duinocloud eshop"><i class="fa fa-angle-right" style="float:right"> duino<span>Cloud.org</span></a></i>

			<ul  style="overflow:hidden" >
			<li class="hide-phone" ><a href="index.html" style="float:left" title="Go back to SmartHouse App Landing Page"><span>HTML</span>SmartHouse</a></li>

			
			<li class="show-phone" ><a href="index.html" style="float:right" title="Go back to SmartHouse App Landing Page"><i class="fa fa-home "></i></a></li>

			<li><a href="device_add.html" style="float:right" title="Add devices to be monitored or controlled"><i class="fa fa-plus "></i></a></li>
			

			<li><a href="device_config.html" style="float:right" title="Setup and configure"><i class="fa fa-gear "></i></a></li>
			<li><a href="help.html" style="float:right" title="Get Help"><i class="fa fa-info "></i></a></li>	
			<li><a href="cloud_connect.html" style="float:right" title="Connect to your Monitoring Cloud"><i class="fa fa-cloud "></i></a></li>

			</ul>
			
  

			
		
	</nav> 


<!-- ===================================== END NAVIGATION BAR ===================================== -->
<div class="callout callout-top table-main" style="overflow:hidden">
 <!-- <div class="grid flex"> -->

	<div class="w3-table-container">
	  <h4>Device Details</h4>
	  
		<div class="clear"></div><br/>
		<div id="status-bar">
			<p id="status-msg"> ... </p>
		</div>
		<div class="clear"></div><br/>	 
		
	  <table id="devices" class="sortable w3-table-all w3-large">
	    <thead>
	      <tr class="w3-light-grey w3-hover-grey">
	        <th>Device Type</th>
			<th>Description</th>
	        <th>Device Status</th>
			<th>Device Activated</th>
	        <th>devID</th>
			<th>ardID</th>
			<th>Last updated</th>
			<th>Actions</th>
	      </tr>
	    </thead>

	  </table>
	</div>

		<div class="clear"></div><br/>
		<div class="clear"></div><br/>
		<div class="clear"></div><br/>

    <div>

		<div class="clear"></div><br/>
		<div class="clear"></div><br/>
		<div class="clear"></div><br/>
		<a class="button red large" href="https://github.com/lballaty/smarthouse"><i class="fa fa-cloud-download"></i> Download Apps (Github)</a> 
		<span style="white-space: nowrap;">
		<a class="button blue large" href=""><i class="fa fa-facebook"></i></a>
		<a class="button blue large" href=""><i class="fa fa-bell"></i></a>
		<a class="button blue large" href="mailto:liborballaty@gmail.com"><i class="fa fa-envelope"></i></a></span><br />
		<p>Downloaded a few times</p> 
		<div class="clear"></div><br/>
		<div class="clear"></div><br/>
		<div class="clear"></div><br/>
		<div class="clear"></div><br/>
	</div>


  <!-- </div> -->
</div>

</body>
<script>
      var socket = io('/iot');
	  
	  // set connection actions
	  socket.on('connect', onConnect);
	  socket.on('connect_error', onConnectError);
	  socket.on('error', onError);
	  // set incoming events
      socket.on('device', setValue);
	  var test = 'hello';

	  function setValue(msg) {
		var devArdID = msg.raspyid + '-' + msg.ardid + '-' + msg.devid;
		console.log('got value: ' + msg.ardid);
		if (document.getElementById(devArdID) == null) {
			if (!msg.activated) { /* only put a device if it is not "Activated" */
				//var devArdID = msg.ardid + "_" + msg.devid;
				trDevName = '<tr id="' + devArdID + '" class="w3-hover-grey"><td>' + devTypeGetName(msg.devType) + '</td>';
				trDesc = '<td><input id="' + devArdID + '_desc" placeholder="Description" /></td>'
				trDevValue = '<td id="' + devArdID + '_value">' + devValueGetName(msg.devType, msg.value) + '</td>'
				trDevActive = '<td>' + msg.activated + '</td>'
				trDevID = '<td>' + msg.devid + '</td>'
				trArdID = '<td>' + msg.ardid + '</td>'
				trLastUpd = '<td id="' + devArdID + '_date">' + ' data here... ' + '</td>'
				trActions = '<td><button id="' + devArdID + '_activate" class="small green"><i class="fa fa-plus-square"></i> Activate</button></td></tr>'
		
				$("#devices").append(trDevName + trDesc + trDevValue + trDevActive + trDevID + trArdID + trLastUpd + trActions);
				$("#" + devArdID + "_activate").click(function() {
					//console.log('test');
					var device = {};
					device.ardID = msg.ardid;
					device.devID = msg.devid;
					device.raspyID = msg.raspyid;
					device.desc = $('#' + devArdID + '_desc').val();
					socket.emit('device_activate', device);
				});
				//console.log('emit() on row add: ' + socket.emit('device_activate', {my : 'test'});
				//socket.emit('device_activate', {my : 'test'})
			}
		} else {
			/* the device already reported, structre needs to be filled in with new data */
			updateDeviceStatus(msg);
		}
      }
	  
	  // color the status-bar div on successful connection
	  function onConnect(msg) {
		console.log("connected to server.");
		$("#status-bar").css( { "background-color": "#1CD935", "border": "3px solid #169126", "width": "95%" } );
		$("#status-msg").text("Connected to server.");
		$("#status-msg").css( { "margin": "5px" });
		 socket.emit('message', 'Hello server');;
	  }
	  
	  // color the status-bar on connection error
	  function onConnectError(msg) {
		console.log("Connection Error!");
		$("#status-bar").css( { "background-color": "#F02626", "border": "3px solid #911631", "width": "95%" } );
		$("#status-msg").text("Disconnected from server: " + msg);
		$("#status-msg").css( { "margin": "5px" });
	  }
	  
	  function onError(msg) {
		console.log("other error: " + msg);
		$("#status-bar").css( { "background-color": "#F02626", "border": "3px solid #911631", "width": "95%" } );
		$("#status-msg").text("Disconnected from server: " + msg);
		$("#status-msg").css( { "margin": "5px" });
	  }
	  
	  /* create the whole HTML table row with the unactivated device */
	  function createTableRow(msg) {
	    var devArdID = msg.raspyid + '-' + msg.ardid + '-' + msg.devid;
		trDevName = '<tr id="' + devArdID + '" class="w3-hover-grey"><td>' + devTypeGetName(msg.devType) + '</td>';
		trDesc = '<td><input id="' + devArdID + '_desc" placeholder="Description" /></td>'
		trDevValue = '<td id="' + devArdID + '_value">' + devValueGetName(msg.devType, msg.value) + '</td>'
		trDevActive = '<td>' + msg.activated + '</td>'
		trDevID = '<td>' + msg.devid + '</td>'
		trArdID = '<td>' + msg.ardid + '</td>'
		trLastUpd = '<td id="' + devArdID + '_date">' + ' ' + '</td>'
		trActions = '<td><button id="' + devArdID + '_activate" class="small green"><i class="fa fa-plus-square"></i> Activate</button></td></tr>'
		
		return trDevName + trDesc + trDevValue + trDevActive + trDevID + trArdID + trLastUpd + trActions;
	  }
	  
	  function onActivateButton(id) {
	    console.log(id);
		//var socket = io('/iot');
		socket.emit('device_activate', id);

	  }
	  
	  /* update the device Status/value according to it's type and sets the time for update */
	  function updateDeviceStatus(msg) {
	    var devArdID = msg.raspyid + '-' + msg.ardid + '-' + msg.devid;
	    $('#' + devArdID + '_value').text(devValueGetName(msg.devType, msg.value));
		//$('#' + devArdID + '_date').text(formatDate(msg.date));
	  }
	  
	  /* formats the date into displayble string from the JSON data object of a device */
	  //function formatDate(date) {
		//return date.y + '-' + date.m + '-' + date.day + ' ' + date.h + ':' + date.min + ':' + date.s + '.' + date.ms ;
	  //}
	  
	  /* provides a string name of status of a device (selects the right status based on the device type) */
	  function devValueGetName(devType, value) {
	    switch (devType){
		  case '1':
		    if (value == '0') 
			  return 'OFF';
			else
			  return 'ON';
			break;
		  default:
		    return value;
		}
	  }
	  
	  /* provides string name of a device type based on devType variable */
	  function devTypeGetName(devType) {
		switch (devType) {
		  case '1':
		    return 'Light';
			break;
		  case '2':
		    return 'Switch';
			break;
		  case '3':
		    return 'Sensor';
			break;
		  case '4':
		    return 'Vent';
			break;
		  case '5':
		    return 'Shade';
			break;
		  case '6':
		    return 'Arduino';
			break;
		  default:
		    return 'Unknown';
			break;
		}
	  }
	  
    </script>
</html>
